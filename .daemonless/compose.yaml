# CIT test compose file
name: booklore-test

services:
  booklore:
    image: ghcr.io/daemonless/booklore:build
    network_mode: host
    environment:
      SPRING_DATASOURCE_URL: "jdbc:mariadb://127.0.0.1:3306/booklore"
      SPRING_DATASOURCE_USERNAME: "booklore"
      SPRING_DATASOURCE_PASSWORD: "testpass"
      JAVA_OPTS: "-Xmx512m"
    volumes:
      - booklore-config:/config
      - booklore-books:/books
    depends_on:
      mariadb:
        condition: service_healthy

  mariadb:
    image: ghcr.io/daemonless/mariadb:11.4
    network_mode: host
    environment:
      MYSQL_ROOT_PASSWORD: "rootpass"
      MYSQL_DATABASE: "booklore"
      MYSQL_USER: "booklore"
      MYSQL_PASSWORD: "testpass"
    volumes:
      - mariadb-data:/config
    healthcheck:
      test: ["CMD", "mariadb", "-u", "booklore", "-ptestpass", "-e", "SELECT 1"]
      interval: 5s
      timeout: 5s
      retries: 20

volumes:
  booklore-config:
  booklore-books:
  mariadb-data:
